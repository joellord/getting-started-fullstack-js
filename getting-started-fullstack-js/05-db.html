<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Add a Database :: Getting Started with OpenShift for Full Stack JavaScript</title>
    <link rel="canonical" href="https://joellord.github.io/getting-started-fullstack-js/getting-started-fullstack-js/05-db.html">
    <link rel="prev" href="04-env.html">
    <link rel="next" href="06-redirector.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://joellord.github.io/getting-started-fullstack-js">Getting Started with OpenShift for Full Stack JavaScript</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="getting-started-fullstack-js" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Getting Started with OpenShift for Full Stack JavaScript</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#devsandbox">Create a Developer Sandbox Account</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#oc">Configure <code>oc</code></a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#locally">Run Application Locally</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-front.html">Deploy the Front-End</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-front.html#build">Build Container</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-front.html#push">Push to a registry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-front.html#newapp">Deploy the front-end</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-front.html#expose">Expose the application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-front.html#status">Verify application status</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-back.html">Deploy the back-end</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-back.html#s2i">Use s2i</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-back.html#clienv">Configure environment variables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-back.html#expose">Expose the application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-back.html#health">Add a health check</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-env.html">Link the front-end and back-end</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-env.html#env">Add the BASE_URL variable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-env.html#test">Test the application</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-db.html">Add a Database</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#catalog">Deploy from the catalog</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#env">Use the UI to configure env variables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#frontenv">Edit front-end env variables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#status">Verify the application status</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-redirector.html">Add a new micro-service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-redirector.html#image">Add from existing image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-redirector.html#env">Update Environment variables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-redirector.html#status">Verify the status of the application</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Getting Started with OpenShift for Full Stack JavaScript</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Getting Started with OpenShift for Full Stack JavaScript</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Getting Started with OpenShift for Full Stack JavaScript</a></li>
    <li><a href="05-db.html">Add a Database</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/joellord/getting-started-fullstack-js/edit/master/documentation/modules/ROOT/pages/05-db.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Add a Database</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You now need to add a database to your application so you can store those links somewhere.</p>
</div>
<div class="paragraph">
<p>In the last sections, you saw how to create your container and deploy it and use s2i to build a container to be deployed. This time, we will use the application catalogue and pick a template to deploy on the cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="catalog"><a class="anchor" href="#catalog"></a>Deploy from the catalogue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From the left navigation bar, click on <em>+Add</em>. This brings up a menu with various options to add your application to the OpenShift cluster.</p>
</div>
<div class="paragraph">
<p>Choose "Database" to open up the developer catalogue filtered out for database templates.
From this view, select the MongoDB (Ephemeral) card. A side panel should open. On this panel, click on the blue <em>Instantiate Template</em> button.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is an ephemeral template for MongoDB. When the pod restarts, all data is lost. This is ideal for development purposes but not so great for production. In the case of a production deployment, you will want to look into operator-backed templates.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On the next screen, fill in the fields with the following values:
* Database Service Name: <code>mongo</code>
* MongoDB Connection Username: <code>shorties</code>
* MongoDB Connection Password: <code>shorties</code>
* MongoDB Database Name: <code>urls</code>
Then click on the blue "Create" button at the bottom.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/mongo-template.png" alt="Instantiating a MongoDB template"></span></p>
</div>
<div class="paragraph">
<p>OpenShift is now creating all the necessary components to deploy this database to your cluster. In a few seconds, you should see the application in the topology view with a blue ring indicating that it is running.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/mongo-running.png" alt="MongoDB up and running in the topology view"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="env"><a class="anchor" href="#env"></a>Use the UI to configure env variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that the database started, it is time to configure the back-end to connect to it.</p>
</div>
<div class="paragraph">
<p>In the last section, you used the CLI to configure the environment variables. This time, you can stay in the comfort of the UI.</p>
</div>
<div class="paragraph">
<p>Click on the urlshortener deployment from the topology view. This will open up a side panel. In the Actions menu on the top right, select <em>Edit Deployment</em>.</p>
</div>
<div class="paragraph">
<p>From this new screen, select the <em>Environment</em> tab, and you should be back to the screen where you added the PORT earlier.</p>
</div>
<div class="paragraph">
<p>Click on "Add More" to add the following environment variables.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MONGO_SERVER: <code>mongo</code></p>
</li>
<li>
<p>MONGO_VERSION: <code>3.6</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the user name and password, you can also use the Secret created by the MongoDB template.</p>
</div>
<div class="paragraph">
<p>Click on <em>Add from Config Map or Secret</em>, and use the name <code>MONGO_USER</code>. In the <em>Select a resource</em> dropdown, pick the Secret named <code>mongo</code>. In the <em>Select a key</em> dropdown, pick <code>database-user</code>.</p>
</div>
<div class="paragraph">
<p>Do the same for <code>MONGO_PASSWORD</code>, which maps to the <code>database-password</code> key.</p>
</div>
<div class="paragraph">
<p>Once you are done, click on the blue "Save" button at the bottom of the page.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/mongo-env-vars.png" alt="MongoDB Environment Variables filled in"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="status"><a class="anchor" href="#status"></a>Verify the application status</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that the database component has been added and the back-end is configured, it&#8217;s time to test the application again.</p>
</div>
<div class="paragraph">
<p>If you open up the front-end and look at the About page, you should now see that the database is up and running.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/db-up.png" alt="Database is up and running"></span></p>
</div>
<div class="paragraph">
<p>You can now use the <em>Add New</em> page to create URL shortcuts, and you can see them on the "Current Shorties" page. All of this data is persisted if you refresh the page.</p>
</div>
<div class="paragraph">
<p>When clicking on the link icon, though, you get an error. This error is because the front-end is trying to contact a redirector service that hasn&#8217;t been deployed yet. This service will be added in the next section.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="04-env.html">Link the front-end and back-end</a></span>
  <span class="next"><a href="06-redirector.html">Add a new micro-service</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
